<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý khuyến mãi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/promotions.css">
</head>
<body>
    <div class="container-fluid">
        <div th:replace="header.html"></div>
        <div class="row">
            <div th:replace="sidebar.html" class="col-md-2 d-none d-md-block bg-light sidebar"></div>
            <main class="col-md-10 ms-auto px-md-4">
                <h1>Quản lý khuyến mãi</h1>
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h3>Danh sách khuyến mãi</h3>
                    <button class="btn btn-primary" onclick="openAddDialog()">Thêm mới</button>
                </div>
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Mã khuyến mãi</th>
                            <th>Giá trị khuyến mãi</th>
                            <th>Thời hạn</th>
                            <th>Điều kiện áp dụng</th>
                            <th>Số lần sử dụng</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody id="promotionList">
                        <!-- Use Thymeleaf to iterate over promotions -->
                        <tr th:each="discount : ${discounts}">
                            <td th:text="${discount.discountID}"></td>
                            <td th:text="${discount.discount} + '%'"></td>
                            <td th:text="${#dates.format(discount.startTime, 'dd/MM/yyyy')} + ' - ' + ${#dates.format(discount.endTime, 'dd/MM/yyyy')}"></td>
                            <td th:text="${discount.minimum}"></td>
                            <td th:text="${discount.quantity}"></td>
                            <td>
                                <button class="btn btn-warning btn-sm"
                                        data-start-date="${#dates.format(discount.startTime, 'yyyy-MM-dd')}"
                                        data-end-date="${#dates.format(discount.endTime, 'yyyy-MM-dd')}"
                                        data-discount-id="${discount.discountID}"
                                        data-discount-value="${discount.discount}"
                                        data-minimum="${discount.minimum}"
                                        data-quantity="${discount.quantity}"
                                        onclick="openEditDialog(this)">Sửa</button>
                                <button class="btn btn-danger btn-sm"
                                        onclick="deleteDiscount('${discount.discountID}')">Xóa</button>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <!-- Modal to Add New Promotion -->
                <div class="modal fade" id="addDialog" tabindex="-1" aria-labelledby="addDialogLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="addDialogLabel">Thêm mới khuyến mãi</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="addPromotionForm">
                                    <div class="mb-3">
                                        <label for="newPromoCode" class="form-label">Mã khuyến mãi</label>
                                        <input type="text" class="form-control" id="newPromoCode" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="newDiscountValue" class="form-label">Giá trị khuyến mãi</label>
                                        <input type="number" class="form-control" id="newDiscountValue" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="newStartTime" class="form-label">Thời gian bắt đầu</label>
                                        <input type="date" class="form-control" id="newStartTime" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="newEndTime" class="form-label">Thời gian kết thúc</label>
                                        <input type="date" class="form-control" id="newEndTime" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="newConditions" class="form-label">Điều kiện áp dụng</label>
                                        <input type="text" class="form-control" id="newConditions" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="newUsageLimit" class="form-label">Giới hạn sử dụng</label>
                                        <input type="number" class="form-control" id="newUsageLimit" required>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                                <button type="button" class="btn btn-primary" id="addPromoButton" onclick="addNewPromotion()">Thêm mới</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal to Edit Promotion -->
                <div class="modal fade" id="editDialog" tabindex="-1" aria-labelledby="editDialogLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="editDialogLabel">Chỉnh sửa khuyến mãi</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="editPromotionForm">
                                    <div class="mb-3">
                                        <label for="editPromoCode" class="form-label">Mã khuyến mãi</label>
                                        <input type="text" class="form-control" id="editPromoCode" readonly>
                                    </div>
                                    <div class="mb-3">
                                        <label for="editDiscountValue" class="form-label">Giá trị khuyến mãi</label>
                                        <input type="number" class="form-control" id="editDiscountValue" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="editStartTime" class="form-label">Thời gian bắt đầu</label>
                                        <input type="date" class="form-control" id="editStartTime" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="editEndTime" class="form-label">Thời gian kết thúc</label>
                                        <input type="date" class="form-control" id="editEndTime" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="editConditions" class="form-label">Điều kiện áp dụng</label>
                                        <input type="text" class="form-control" id="editConditions" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="editUsageLimit" class="form-label">Giới hạn sử dụng</label>
                                        <input type="number" class="form-control" id="editUsageLimit" required>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                                <button type="button" class="btn btn-primary" id="editPromoButton" onclick="editPromotion()">Lưu thay đổi</button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/promotions.js"></script>
</body>
</html>
